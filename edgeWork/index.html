<html>
<head>
	<title>Edge Work Feedback</title>
	<script src="webgl-utils.js"></script>
	<script src="fboTextureUtils.js"></script>
</head>
<body>
	<input type="range" id="radius" min="-30" value="1" max='30' step="0.2" style="position:absolute; z-index:100">
    <canvas id="canvas" style ="background:black; position:absolute;top:0;left:0;z-index:0; width:100%; height:100%;">
      Sorry but your browser doesn't support the canvas :(
    </canvas>



	<script id="baseVs" type="x-shader/x-vertex">
	attribute vec3 pos;
	attribute vec4 color;
	attribute vec2 texcoord;

	varying vec2 v_texCoord;
	varying vec4 vColor;

	void main() {

	   gl_Position = vec4((pos.x*1.0),pos.y,pos.z,1.0);
	   v_texCoord = texcoord;
	   vColor = color;

	}
	</script>
	<script id="translateVs" type="x-shader/x-vertex">
	//attributes come from fboTextureUtils
	attribute vec3 pos;
	attribute vec4 color;
	attribute vec2 texcoord;

	varying vec2 v_texCoord;
	varying vec4 vColor;

	uniform vec2 mouse;

	vec2 scale = vec2(1.01,1.01);
	void main() {
	   gl_Position = vec4(pos.x*scale.x,pos.y*scale.y,pos.z,1.0);
	   v_texCoord = texcoord;
	   vColor = color;
	}
	</script>
	<script id="baseFs" type="x-shader/x-fragment">
	precision mediump float;
	uniform sampler2D u_image;
	varying vec2 v_texCoord;

	void main() {
	  vec4 color = texture2D(u_image, v_texCoord);
	  gl_FragColor = vec4(color.r,color.g,color.b,1.0);
	}
	</script>
	<script id="edgeFs1" type="x-shader/x-fragment">
	precision mediump float;
    uniform sampler2D u_image;
    uniform vec2 delta;
    varying vec2 v_texCoord;
    float random(vec3 scale, float seed) {
		return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
    }
    void main() {
        vec2 color = vec2(0.0);
        vec2 total = vec2(0.0);
        
        float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
        
        for (float t = -30.0; t <= 30.0; t++) {
            float percent = (t + offset - 0.5) / 30.0;
            float weight = 1.0 - abs(percent);
            vec3 sample = texture2D(u_image, v_texCoord + delta * percent).rgb;
            float average = (sample.r + sample.g + sample.b) / 3.0;
            color.x += average * weight;
            total.x += weight;
            if (abs(t) < 15.0) {
                weight = weight * 2.0 - 1.0;
                color.y += average * weight;
                total.y += weight;
            }
        }
        // gl_FragColor = vec4(color / total, 0.0, 1.0);
        gl_FragColor = vec4((texture2D(u_image, v_texCoord).rgb + vec3(1.0,0.0,0.0))*0.5,1.0);
;
    }
	</script>
	<script id="edgeFs2" type="x-shader/x-fragment">
	precision mediump float;
    uniform sampler2D u_image;
    uniform vec2 delta;
    varying vec2 v_texCoord;
    float random(vec3 scale, float seed) {
		return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
    }
    void main() {
        vec2 color = vec2(0.0);
        vec2 total = vec2(0.0);
        
        float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
        
        for (float t = -30.0; t <= 30.0; t++) {
            float percent = (t + offset - 0.5) / 30.0;
            float weight = 1.0 - abs(percent);            
            vec2 sample = texture2D(u_image, v_texCoord + delta * percent).xy;
            color.x += sample.x * weight;
            total.x += weight;
            if (abs(t) < 15.0) {
                weight = weight * 2.0 - 1.0;
                color.y += sample.y * weight;
                total.y += weight;
            }
        }
        float c = clamp(10000.0 * (color.y / total.y - color.x / total.x) + 0.5, 0.0, 1.0);
        gl_FragColor = vec4(c, c, c, 1.0);
        // gl_FragColor = vec4(texture2D(u_image, v_texCoord).rgb, 0.5);
    }
	</script>

	<script src="main.js"></script>
</body>
</html>